<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Formulário - VSM Informática</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --brand:#002b5c;
    --accent:#0074d9;
    --bg:#f6f7fb;
    --card:#ffffff;
    --muted:#6b7280;
  }
  *{box-sizing:border-box;font-family:'Inter',system-ui,Helvetica,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:#111;line-height:1.4}
  header{background:linear-gradient(90deg,var(--brand),#004b8c);color:white;padding:22px 16px;text-align:center}
  header h1{margin:0;font-size:20px}
  header p{margin:6px 0 0;font-size:13px;opacity:0.95}
  main{max-width:980px;margin:26px auto;padding:22px;border-radius:12px;background:var(--card);box-shadow:0 6px 22px rgba(2,6,23,0.06)}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:20px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{padding:16px;border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);border:1px solid rgba(2,6,23,0.04)}
  .choose{display:flex;gap:12px;flex-direction:column}
  .option{padding:14px;border-radius:8px;border:1px solid #e6eefb;background:#fff;cursor:pointer;transition:transform .12s,box-shadow .12s}
  .option:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(2,27,68,0.06)}
  .option b{display:block;color:var(--brand)}
  label{display:block;font-weight:600;margin-top:12px;font-size:13px;color:#0b2540}
  input[type="text"],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #d2dbe8;margin-top:6px;font-size:14px}
  button{background:var(--brand);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
  .btn-row{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}
  .muted{color:var(--muted);font-size:13px}
  .success{background:#e6ffef;border-color:#b7f0cf;color:#0b6b34;padding:10px;border-radius:8px}
  .error{background:#ffecea;border-color:#ffbdb5;color:#8a1a1a;padding:10px;border-radius:8px}
  .small{font-size:13px}
  textarea{min-height:84px;resize:vertical}
  .right-card h3{margin:0 0 8px;font-size:18px;color:var(--brand)}
</style>
</head>
<body>
<header>
  <h1>VSM Informática Assis LTDA – ME</h1>
  <p>Solicitação de alteração de CNPJ — formulário automático</p>
</header>

<main>
  <div class="grid">
    <div class="card">
      <div id="step1" class="choose">
        <div class="option" onclick="showForm('banco')">
          <b>Via Banco de Dados (sem custo)</b>
          <p class="small muted">Atualiza apenas o CNPJ mantendo dados do cadastro anterior.</p>
        </div>
        <div class="option" onclick="showForm('nova')">
          <b>Nova Loja (novo banco de dados)</b>
          <p class="small muted">Cria nova empresa — importação e taxas opcionais.</p>
        </div>
      </div>

      <!-- Form Banco -->
      <form id="banco" style="display:none;" onsubmit="submitForm(event,'banco')" class="small">
        <input type="hidden" name="tipo" value="Via Banco de Dados">
        <label>Razão Social<input type="text" name="razao" placeholder="Razão social"></label>
        <label>Nome Fantasia<input type="text" name="fantasia" placeholder="Nome fantasia"></label>
        <label>CNPJ Novo<input type="text" name="cnpj_novo" placeholder="00.000.000/0000-00"></label>

        <label>O novo CNPJ possui certificado digital?
          <select name="certificado">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O novo CNPJ está apto para realizar vendas?
          <select name="vendas">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>Modelo de documento fiscal
          <select name="modelo">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>SAT (SP)</option>
            <option>ECF (SC)</option>
            <option>NFC-e</option>
          </select>
        </label>

        <label>O modelo já está vinculado ao novo CNPJ?
          <select name="vinculado">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O novo CNPJ possui cadastro no SNGPC?
          <select name="sngpc">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O novo CNPJ possui integração com a Avant Fiscal?
          <select name="avant">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O CNPJ antigo será finalizado?
          <select name="finaliza">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>Observações
          <textarea name="observacoes" placeholder="Alguma observação adicional (opcional)"></textarea>
        </label>

        <div class="btn-row">
          <button type="button" onclick="goBack()">⬅ Voltar</button>
          <button type="submit">Enviar</button>
        </div>
      </form>

      <!-- Form Nova Loja -->
      <form id="nova" style="display:none;" onsubmit="submitForm(event,'nova')" class="small">
        <input type="hidden" name="tipo" value="Nova Loja">
        <label>Razão Social<input type="text" name="razao2" placeholder="Razão social"></label>
        <label>Nome Fantasia<input type="text" name="fantasia2" placeholder="Nome fantasia"></label>
        <label>CNPJ Novo<input type="text" name="cnpj_novo2" placeholder="00.000.000/0000-00"></label>

        <label>Importação de Estoque
          <select name="estoque">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Não importar (Sem custo)</option>
            <option>Importar estoque (Exceto SNGPC) - R$ 100,00</option>
            <option>Gerar notas de venda (Inclui SNGPC) - R$ 250,00</option>
          </select>
        </label>

        <label>O novo CNPJ possui certificado digital?
          <select name="certificado2">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O novo CNPJ está apto para realizar vendas?
          <select name="vendas2">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O novo CNPJ possui integração com a Avant Fiscal?
          <select name="avant2">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>O CNPJ antigo será finalizado?
          <select name="finaliza2">
            <option value="" selected disabled>Selecione uma opção</option>
            <option>Sim</option>
            <option>Não</option>
          </select>
        </label>

        <label>Observações
          <textarea name="observacoes" placeholder="Alguma observação adicional (opcional)"></textarea>
        </label>

        <div class="btn-row">
          <button type="button" onclick="goBack()">⬅ Voltar</button>
          <button type="submit">Enviar</button>
        </div>
      </form>
    </div>

    <aside class="card right-card">
      <h3>Status</h3>
      <div id="status" class="muted">Escolha o tipo de alteração à esquerda e preencha os dados.</div>
      <hr style="margin:12px 0">
      <div class="muted small">
        <strong>Recebimento:</strong><br>
        Os dados serão enviados automaticamente por e-mail e salvos em uma planilha do Google.
      </div>
    </aside>
  </div>
</main>

<script>
  function showForm(id){
    document.getElementById('step1').style.display = 'none';
    document.getElementById('banco').style.display = id === 'banco' ? 'block' : 'none';
    document.getElementById('nova').style.display = id === 'nova' ? 'block' : 'none';
    document.getElementById('status').innerText = 'Preencha o formulário e clique em Enviar.';
  }

  function goBack(){
    document.getElementById('step1').style.display = 'flex';
    document.getElementById('banco').style.display = 'none';
    document.getElementById('nova').style.display = 'none';
    document.getElementById('status').innerText = 'Escolha o tipo de alteração à esquerda e preencha os dados.';
  }

 async function submitForm(e, formId) {
  e.preventDefault();
  const form = document.getElementById(formId);
  const data = Object.fromEntries(new FormData(form).entries());

  // Verificar o conteúdo dos dados antes de enviar
  console.log(data);

  const required = formId === 'banco' ? ['razao', 'fantasia', 'cnpj_novo'] : ['razao2', 'fantasia2', 'cnpj_novo2'];
  const missing = required.filter(k => !data[k] || data[k].trim() === '');
  if (missing.length) {
    document.getElementById('status').innerHTML = '<div class="error">Preencha os campos obrigatórios: ' + missing.join(', ') + '</div>';
    return;
  }

  document.getElementById('status').innerHTML = '<div class="muted">Enviando...</div>';

  try {
    const formData = new FormData();
    for (const key in data) formData.append(key, data[key]);

    // Verificar o que está sendo enviado
    console.log([...formData]);

    const resp = await fetch('https://cors-anywhere.herokuapp.com/https://script.google.com/macros/s/AKfycbytgNbO26VzfMhTxSr4szxQLcYBmI33U5BfMBjVfipSjtZSl-lGXcVo766NOC17xBrODQ/exec', {
      method: 'POST',
      body: formData,
    });

    const text = await resp.text();
    if (text.includes('ok') || text.includes('true')) {
      document.getElementById('status').innerHTML = '<div class="success">✅ Dados enviados com sucesso!</div>';
      form.reset();
      setTimeout(() => goBack(), 1800);
    } else {
      document.getElementById('status').innerHTML = '<div class="error">Erro inesperado: ' + text + '</div>';
    }

  } catch (err) {
    document.getElementById('status').innerHTML = '<div class="error">Erro de conexão: ' + err.message + '</div>';
  }
}


</script>
</body>
</html>
